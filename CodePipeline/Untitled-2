  ModelTrainingProject:
    Type: AWS::CodeBuild::Project
    Properties:
      Name: !Sub ${AWS::StackName}-pipeline-modeltraining
      Description: Trains machine learning model using SageMaker
      ServiceRole: !GetAtt CodeBuildRole.Arn
      Artifacts:
        Type: CODEPIPELINE
      Environment:
        Type: LINUX_CONTAINER
        ComputeType: BUILD_GENERAL1_SMALL
        Image: aws/codebuild/eb-python-3.4-amazonlinux-64:2.1.6
      Source:
        Type: CODEPIPELINE
        BuildSpec: !Sub |
          version: 0.2
          phases:
            install:
              commands:
                - echo "Installing wget and boto3"
                - pip3 install wget
                - pip3 install boto3
            build:
              commands:
                - echo "Running training.py"
                - ls
                - python3 Source/training.py "${SagemakerRole.Arn}" "${DataBucket}"
                - ls
            post_build:
              commands:
                - rm caltech*
                - ls
          artifacts:
            files:
              - '**/*'
      TimeoutInMinutes: 30